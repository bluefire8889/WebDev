{"version":3,"file":"jspdf.es.js","sources":["../src/libs/globalObject.js","../src/libs/console.js","../src/libs/FileSaver.js","../src/libs/rgbcolor.js","../src/libs/AtobBtoa.js","../src/jspdf.js","../src/modules/acroform.js","../src/modules/addimage.js","../src/modules/annotations.js","../src/modules/arabic.js","../src/modules/autoprint.js","../src/modules/canvas.js","../src/modules/cell.js","../src/modules/context2d.js","../src/libs/Deflater.js","../src/modules/filters.js","../src/modules/fileloading.js","../src/libs/loadOptionalLibrary.js","../src/modules/html.js","../src/modules/javascript.js","../src/modules/outline.js","../src/modules/jpeg_support.js","../src/libs/zlib.js","../src/libs/png.js","../src/modules/png_support.js","../src/libs/omggif.js","../src/libs/JPEGEncoder.js","../src/modules/gif_support.js","../src/libs/BMPDecoder.js","../src/modules/bmp_support.js","../src/libs/WebPDecoder.js","../src/modules/webp_support.js","../src/modules/setlanguage.js","../src/modules/split_text_to_size.js","../src/modules/standard_fonts_metrics.js","../src/modules/ttfsupport.js","../src/modules/svg.js","../src/modules/total_pages.js","../src/modules/viewerpreferences.js","../src/modules/xmp_metadata.js","../src/modules/utf8.js","../src/modules/vfs.js","../src/libs/bidiEngine.js","../src/libs/ttffont.js","../src/libs/adler32cs.js"],"sourcesContent":["export var globalObject = (function() {\n  return \"undefined\" !== typeof window\n    ? window\n    : \"undefined\" !== typeof global\n    ? global\n    : \"undefined\" !== typeof self\n    ? self\n    : this;\n})();\n","import { globalObject } from \"./globalObject.js\";\n\nfunction consoleLog() {\n  if (globalObject.console && typeof globalObject.console.log === \"function\") {\n    globalObject.console.log.apply(globalObject.console, arguments);\n  }\n}\n\nfunction consoleWarn(str) {\n  if (globalObject.console) {\n    if (typeof globalObject.console.warn === \"function\") {\n      globalObject.console.warn.apply(globalObject.console, arguments);\n    } else {\n      consoleLog.call(null, arguments);\n    }\n  }\n}\n\nfunction consoleError(str) {\n  if (globalObject.console) {\n    if (typeof globalObject.console.error === \"function\") {\n      globalObject.console.error.apply(globalObject.console, arguments);\n    } else {\n      consoleLog(str);\n    }\n  }\n}\nexport var console = {\n  log: consoleLog,\n  warn: consoleWarn,\n  error: consoleError\n};\n","/**\n * @license\n * FileSaver.js\n * A saveAs() FileSaver implementation.\n *\n * By Eli Grey, http://eligrey.com\n *\n * License : https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md (MIT)\n * source  : http://purl.eligrey.com/github/FileSaver.js\n */\n\nimport { globalObject as _global } from \"./globalObject.js\";\nimport { console } from \"./console.js\";\n\nfunction bom(blob, opts) {\n  if (typeof opts === \"undefined\") opts = { autoBom: false };\n  else if (typeof opts !== \"object\") {\n    console.warn(\"Deprecated: Expected third argument to be a object\");\n    opts = { autoBom: !opts };\n  }\n\n  // prepend BOM for UTF-8 XML and text/* types (including HTML)\n  // note: your browser will automatically convert UTF-16 U+FEFF to EF BB BF\n  if (\n    opts.autoBom &&\n    /^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(\n      blob.type\n    )\n  ) {\n    return new Blob([String.fromCharCode(0xfeff), blob], { type: blob.type });\n  }\n  return blob;\n}\n\nfunction download(url, name, opts) {\n  var xhr = new XMLHttpRequest();\n  xhr.open(\"GET\", url);\n  xhr.responseType = \"blob\";\n  xhr.onload = function() {\n    saveAs(xhr.response, name, opts);\n  };\n  xhr.onerror = function() {\n    console.error(\"could not download file\");\n  };\n  xhr.send();\n}\n\nfunction corsEnabled(url) {\n  var xhr = new XMLHttpRequest();\n  // use sync to avoid popup blocker\n  xhr.open(\"HEAD\", url, false);\n  try {\n    xhr.send();\n  } catch (e) {}\n  return xhr.status >= 200 && xhr.status <= 299;\n}\n\n// `a.click()` doesn't work for all browsers (#465)\nfunction click(node) {\n  try {\n    node.dispatchEvent(new MouseEvent(\"click\"));\n  } catch (e) {\n    var evt = document.createEvent(\"MouseEvents\");\n    evt.initMouseEvent(\n      \"click\",\n      true,\n      true,\n      window,\n      0,\n      0,\n      0,\n      80,\n      20,\n      false,\n      false,\n      false,\n      false,\n      0,\n      null\n    );\n    node.dispatchEvent(evt);\n  }\n}\n\nvar saveAs =\n  _global.saveAs ||\n  // probably in some web worker\n  (typeof window !== \"object\" || window !== _global\n    ? function saveAs() {\n        /* noop */\n      }\n    : // Use download attribute first if possible (#193 Lumia mobile)\n    \"download\" in HTMLAnchorElement.prototype\n    ? function saveAs(blob, name, opts) {\n        var URL = _global.URL || _global.webkitURL;\n        var a = document.createElement(\"a\");\n        name = name || blob.name || \"download\";\n\n        a.download = name;\n        a.rel = \"noopener\"; // tabnabbing\n\n        // TODO: detect chrome extensions & packaged apps\n        // a.target = '_blank'\n\n        if (typeof blob === \"string\") {\n          // Support regular links\n          a.href = blob;\n          if (a.origin !== location.origin) {\n            corsEnabled(a.href)\n              ? download(blob, name, opts)\n              : click(a, (a.target = \"_blank\"));\n          } else {\n            click(a);\n          }\n        } else {\n          // Support blobs\n          a.href = URL.createObjectURL(blob);\n          setTimeout(function() {\n            URL.revokeObjectURL(a.href);\n          }, 4e4); // 40s\n          setTimeout(function() {\n            click(a);\n          }, 0);\n        }\n      }\n    : // Use msSaveOrOpenBlob as a second approach\n    \"msSaveOrOpenBlob\" in navigator\n    ? function saveAs(blob, name, opts) {\n        name = name || blob.name || \"download\";\n\n        if (typeof blob === \"string\") {\n          if (corsEnabled(blob)) {\n            download(blob, name, opts);\n          } else {\n            var a = document.createElement(\"a\");\n            a.href = blob;\n            a.target = \"_blank\";\n            setTimeout(function() {\n              click(a);\n            });\n          }\n        } else {\n          navigator.msSaveOrOpenBlob(bom(blob, opts), name);\n        }\n      }\n    : // Fallback to using FileReader and a popup\n      function saveAs(blob, name, opts, popup) {\n        // Open a popup immediately do go around popup blocker\n        // Mostly only available on user interaction and the fileReader is async so...\n        popup = popup || open(\"\", \"_blank\");\n        if (popup) {\n          popup.document.title = popup.document.body.innerText =\n            \"downloading...\";\n        }\n\n        if (typeof blob === \"string\") return download(blob, name, opts);\n\n        var force = blob.type === \"application/octet-stream\";\n        var isSafari =\n          /constructor/i.test(_global.HTMLElement) || _global.safari;\n        var isChromeIOS = /CriOS\\/[\\d]+/.test(navigator.userAgent);\n\n        if (\n          (isChromeIOS || (force && isSafari)) &&\n          typeof FileReader === \"object\"\n        ) {\n          // Safari doesn't allow downloading of blob URLs\n          var reader = new FileReader();\n          reader.onloadend = function() {\n            var url = reader.result;\n            url = isChromeIOS\n              ? url\n              : url.replace(/^data:[^;]*;/, \"data:attachment/file;\");\n            if (popup) popup.location.href = url;\n            else location = url;\n            popup = null; // reverse-tabnabbing #460\n          };\n          reader.readAsDataURL(blob);\n        } else {\n          var URL = _global.URL || _global.webkitURL;\n          var url = URL.createObjectURL(blob);\n          if (popup) popup.location = url;\n          else location.href = url;\n          popup = null; // reverse-tabnabbing #460\n          setTimeout(function() {\n            URL.revokeObjectURL(url);\n          }, 4e4); // 40s\n        }\n      });\n\nexport { saveAs };\n","/**\n * A class to parse color values\n * @author Stoyan Stefanov <sstoo@gmail.com>\n * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}\n * @license Use it if you like it\n */\n\nfunction RGBColor(color_string) {\n  color_string = color_string || \"\";\n  this.ok = false;\n\n  // strip any leading #\n  if (color_string.charAt(0) == \"#\") {\n    // remove # if any\n    color_string = color_string.substr(1, 6);\n  }\n\n  color_string = color_string.replace(/ /g, \"\");\n  color_string = color_string.toLowerCase();\n\n  var channels;\n\n  // before getting into regexps, try simple matches\n  // and overwrite the input\n  var simple_colors = {\n    aliceblue: \"f0f8ff\",\n    antiquewhite: \"faebd7\",\n    aqua: \"00ffff\",\n    aquamarine: \"7fffd4\",\n    azure: \"f0ffff\",\n    beige: \"f5f5dc\",\n    bisque: \"ffe4c4\",\n    black: \"000000\",\n    blanchedalmond: \"ffebcd\",\n    blue: \"0000ff\",\n    blueviolet: \"8a2be2\",\n    brown: \"a52a2a\",\n    burlywood: \"deb887\",\n    cadetblue: \"5f9ea0\",\n    chartreuse: \"7fff00\",\n    chocolate: \"d2691e\",\n    coral: \"ff7f50\",\n    cornflowerblue: \"6495ed\",\n    cornsilk: \"fff8dc\",\n    crimson: \"dc143c\",\n    cyan: \"00ffff\",\n    darkblue: \"00008b\",\n    darkcyan: \"008b8b\",\n    darkgoldenrod: \"b8860b\",\n    darkgray: \"a9a9a9\",\n    darkgreen: \"006400\",\n    darkkhaki: \"bdb76b\",\n    darkmagenta: \"8b008b\",\n    darkolivegreen: \"556b2f\",\n    darkorange: \"ff8c00\",\n    darkorchid: \"9932cc\",\n    darkred: \"8b0000\",\n    darksalmon: \"e9967a\",\n    darkseagreen: \"8fbc8f\",\n    darkslateblue: \"483d8b\",\n    darkslategray: \"2f4f4f\",\n    darkturquoise: \"00ced1\",\n    darkviolet: \"9400d3\",\n    deeppink: \"ff1493\",\n    deepskyblue: \"00bfff\",\n    dimgray: \"696969\",\n    dodgerblue: \"1e90ff\",\n    feldspar: \"d19275\",\n    firebrick: \"b22222\",\n    floralwhite: \"fffaf0\",\n    forestgreen: \"228b22\",\n    fuchsia: \"ff00ff\",\n    gainsboro: \"dcdcdc\",\n    ghostwhite: \"f8f8ff\",\n    gold: \"ffd700\",\n    goldenrod: \"daa520\",\n    gray: \"808080\",\n    green: \"008000\",\n    greenyellow: \"adff2f\",\n    honeydew: \"f0fff0\",\n    hotpink: \"ff69b4\",\n    indianred: \"cd5c5c\",\n    indigo: \"4b0082\",\n    ivory: \"fffff0\",\n    khaki: \"f0e68c\",\n    lavender: \"e6e6fa\",\n    lavenderblush: \"fff0f5\",\n    lawngreen: \"7cfc00\",\n    lemonchiffon: \"fffacd\",\n    lightblue: \"add8e6\",\n    lightcoral: \"f08080\",\n    lightcyan: \"e0ffff\",\n    lightgoldenrodyellow: \"fafad2\",\n    lightgrey: \"d3d3d3\",\n    lightgreen: \"90ee90\",\n    lightpink: \"ffb6c1\",\n    lightsalmon: \"ffa07a\",\n    lightseagreen: \"20b2aa\",\n    lightskyblue: \"87cefa\",\n    lightslateblue: \"8470ff\",\n    lightslategray: \"778899\",\n    lightsteelblue: \"b0c4de\",\n    lightyellow: \"ffffe0\",\n    lime: \"00ff00\",\n    limegreen: \"32cd32\",\n    linen: \"faf0e6\",\n    magenta: \"ff00ff\",\n    maroon: \"800000\",\n    mediumaquamarine: \"66cdaa\",\n    mediumblue: \"0000cd\",\n    mediumorchid: \"ba55d3\",\n    mediumpurple: \"9370d8\",\n    mediumseagreen: \"3cb371\",\n    mediumslateblue: \"7b68ee\",\n    mediumspringgreen: \"00fa9a\",\n    mediumturquoise: \"48d1cc\",\n    mediumvioletred: \"c71585\",\n    midnightblue: \"191970\",\n    mintcream: \"f5fffa\",\n    mistyrose: \"ffe4e1\",\n    moccasin: \"ffe4b5\",\n    navajowhite: \"ffdead\",\n    navy: \"000080\",\n    oldlace: \"fdf5e6\",\n    olive: \"808000\",\n    olivedrab: \"6b8e23\",\n    orange: \"ffa500\",\n    orangered: \"ff4500\",\n    orchid: \"da70d6\",\n    palegoldenrod: \"eee8aa\",\n    palegreen: \"98fb98\",\n    paleturquoise: \"afeeee\",\n    palevioletred: \"d87093\",\n    papayawhip: \"ffefd5\",\n    peachpuff: \"ffdab9\",\n    peru: \"cd853f\",\n    pink: \"ffc0cb\",\n    plum: \"dda0dd\",\n    powderblue: \"b0e0e6\",\n    purple: \"800080\",\n    red: \"ff0000\",\n    rosybrown: \"bc8f8f\",\n    royalblue: \"4169e1\",\n    saddlebrown: \"8b4513\",\n    salmon: \"fa8072\",\n    sandybrown: \"f4a460\",\n    seagreen: \"2e8b57\",\n    seashell: \"fff5ee\",\n    sienna: \"a0522d\",\n    silver: \"c0c0c0\",\n    skyblue: \"87ceeb\",\n    slateblue: \"6a5acd\",\n    slategray: \"708090\",\n    snow: \"fffafa\",\n    springgreen: \"00ff7f\",\n    steelblue: \"4682b4\",\n    tan: \"d2b48c\",\n    teal: \"008080\",\n    thistle: \"d8bfd8\",\n    tomato: \"ff6347\",\n    turquoise: \"40e0d0\",\n    violet: \"ee82ee\",\n    violetred: \"d02090\",\n    wheat: \"f5deb3\",\n    white: \"ffffff\",\n    whitesmoke: \"f5f5f5\",\n    yellow: \"ffff00\",\n    yellowgreen: \"9acd32\"\n  };\n  color_string = simple_colors[color_string] || color_string;\n\n  // array of color definition objects\n  var color_defs = [\n    {\n      re: /^rgb\\((\\d{1,3}),\\s*(\\d{1,3}),\\s*(\\d{1,3})\\)$/,\n      example: [\"rgb(123, 234, 45)\", \"rgb(255,234,245)\"],\n      process: function(bits) {\n        return [parseInt(bits[1]), parseInt(bits[2]), parseInt(bits[3])];\n      }\n    },\n    {\n      re: /^(\\w{2})(\\w{2})(\\w{2})$/,\n      example: [\"#00ff00\", \"336699\"],\n      process: function(bits) {\n        return [\n          parseInt(bits[1], 16),\n          parseInt(bits[2], 16),\n          parseInt(bits[3], 16)\n        ];\n      }\n    },\n    {\n      re: /^(\\w{1})(\\w{1})(\\w{1})$/,\n      example: [\"#fb0\", \"f0f\"],\n      process: function(bits) {\n        return [\n          parseInt(bits[1] + bits[1], 16),\n          parseInt(bits[2] + bits[2], 16),\n          parseInt(bits[3] + bits[3], 16)\n        ];\n      }\n    }\n  ];\n\n  // search through the definitions to find a match\n  for (var i = 0; i < color_defs.length; i++) {\n    var re = color_defs[i].re;\n    var processor = color_defs[i].process;\n    var bits = re.exec(color_string);\n    if (bits) {\n      channels = processor(bits);\n      this.r = channels[0];\n      this.g = channels[1];\n      this.b = channels[2];\n      this.ok = true;\n    }\n  }\n\n  // validate/cleanup values\n  this.r = this.r < 0 || isNaN(this.r) ? 0 : this.r > 255 ? 255 : this.r;\n  this.g = this.g < 0 || isNaN(this.g) ? 0 : this.g > 255 ? 255 : this.g;\n  this.b = this.b < 0 || isNaN(this.b) ? 0 : this.b > 255 ? 255 : this.b;\n\n  // some getters\n  this.toRGB = function() {\n    return \"rgb(\" + this.r + \", \" + this.g + \", \" + this.b + \")\";\n  };\n  this.toHex = function() {\n    var r = this.r.toString(16);\n    var g = this.g.toString(16);\n    var b = this.b.toString(16);\n    if (r.length == 1) r = \"0\" + r;\n    if (g.length == 1) g = \"0\" + g;\n    if (b.length == 1) b = \"0\" + b;\n    return \"#\" + r + g + b;\n  };\n}\n\nexport { RGBColor };\n","import { globalObject } from \"./globalObject.js\";\n\nvar atob, btoa;\n\n(function() {\n  atob = globalObject.atob;\n  btoa = globalObject.btoa;\n  return;\n\n})();\n\nexport { atob, btoa };\n","/* eslint-disable no-console */\n\nimport { saveAs } from \"./libs/FileSaver.js\";\nimport { globalObject } from \"./libs/globalObject.js\";\nimport { RGBColor } from \"./libs/rgbcolor.js\";\nimport { btoa } from \"./libs/AtobBtoa.js\";\nimport { console } from \"./libs/console.js\";\n\n/**\n * jsPDF's Internal PubSub Implementation.\n * Backward compatible rewritten on 2014 by\n * Diego Casorran, https://github.com/diegocr\n *\n * @class\n * @name PubSub\n * @ignore\n */\nfunction PubSub(context) {\n  if (typeof context !== \"object\") {\n    throw new Error(\n      \"Invalid Context passed to initialize PubSub (jsPDF-module)\"\n    );\n  }\n  var topics = {};\n\n  this.subscribe = function(topic, callback, once) {\n    once = once || false;\n    if (\n      typeof topic !== \"string\" ||\n      typeof callback !== \"function\" ||\n      typeof once !== \"boolean\"\n    ) {\n      throw new Error(\n        \"Invalid arguments passed to PubSub.subscribe (jsPDF-module)\"\n      );\n    }\n\n    if (!topics.hasOwnProperty(topic)) {\n      topics[topic] = {};\n    }\n\n    var token = Math.random().toString(35);\n    topics[topic][token] = [callback, !!once];\n\n    return token;\n  };\n\n  this.unsubscribe = function(token) {\n    for (var topic in topics) {\n      if (topics[topic][token]) {\n        delete topics[topic][token];\n        if (Object.keys(topics[topic]).length === 0) {\n          delete topics[topic];\n        }\n        return true;\n      }\n    }\n    return false;\n  };\n\n  this.publish = function(topic) {\n    if (topics.hasOwnProperty(topic)) {\n      var args = Array.prototype.slice.call(arguments, 1),\n        tokens = [];\n\n      for (var token in topics[topic]) {\n        var sub = topics[topic][token];\n        try {\n          sub[0].apply(context, args);\n        } catch (ex) {\n          if (globalObject.console) {\n            console.error(\"jsPDF PubSub Error\", ex.message, ex);\n          }\n        }\n        if (sub[1]) tokens.push(token);\n      }\n      if (tokens.length) tokens.forEach(this.unsubscribe);\n    }\n  };\n\n  this.getTopics = function() {\n    return topics;\n  };\n}\n\nfunction GState(parameters) {\n  if (!(this instanceof GState)) {\n    return new GState(parameters);\n  }\n\n  /**\n   * @name GState#opacity\n   * @type {any}\n   */\n  /**\n   * @name GState#stroke-opacity\n   * @type {any}\n   */\n  var supported = \"opacity,stroke-opacity\".split(\",\");\n  for (var p in parameters) {\n    if (parameters.hasOwnProperty(p) && supported.indexOf(p) >= 0) {\n      this[p] = parameters[p];\n    }\n  }\n  /**\n   * @name GState#id\n   * @type {string}\n   */\n  this.id = \"\"; // set by addGState()\n  /**\n   * @name GState#objectNumber\n   * @type {number}\n   */\n  this.objectNumber = -1; // will be set by putGState()\n}\n\nGState.prototype.equals = function equals(other) {\n  var ignore = \"id,objectNumber,equals\";\n  var p;\n  if (!other || typeof other !== typeof this) return false;\n  var count = 0;\n  for (p in this) {\n    if (ignore.indexOf(p) >= 0) continue;\n    if (this.hasOwnProperty(p) && !other.hasOwnProperty(p)) return false;\n    if (this[p] !== other[p]) return false;\n    count++;\n  }\n  for (p in other) {\n    if (other.hasOwnProperty(p) && ignore.indexOf(p) < 0) count--;\n  }\n  return count === 0;\n};\n\nfunction Pattern(gState, matrix) {\n  this.gState = gState;\n  this.matrix = matrix;\n\n  this.id = \"\"; // set by addPattern()\n  this.objectNumber = -1; // will be set by putPattern()\n}\n\nfunction ShadingPattern(type, coords, colors, gState, matrix) {\n  if (!(this instanceof ShadingPattern)) {\n    return new ShadingPattern(type, coords, colors, gState, matrix);\n  }\n\n  // see putPattern() for information how they are realized\n  this.type = type === \"axial\" ? 2 : 3;\n  this.coords = coords;\n  this.colors = colors;\n\n  Pattern.call(this, gState, matrix);\n}\n\nfunction TilingPattern(boundingBox, xStep, yStep, gState, matrix) {\n  if (!(this instanceof TilingPattern)) {\n    return new TilingPattern(boundingBox, xStep, yStep, gState, matrix);\n  }\n\n  this.boundingBox = boundingBox;\n  this.xStep = xStep;\n  this.yStep = yStep;\n\n  this.stream = \"\"; // set by endTilingPattern();\n\n  this.cloneIndex = 0;\n\n  Pattern.call(this, gState, matrix);\n}\n\n/**\n * Creates new jsPDF document object instance.\n * @name jsPDF\n * @class\n * @param {Object} [options] - Collection of settings initializing the jsPDF-instance\n * @param {string} [options.orientation=portrait] - Orientation of the first page. Possible values are \"portrait\" or \"landscape\" (or shortcuts \"p\" or \"l\").<br />\n * @param {string} [options.unit=mm] Measurement unit (base unit) to be used when coordinates are specified.<br />\n * Possible values are \"pt\" (points), \"mm\", \"cm\", \"m\", \"in\" or \"px\".\n * @param {string/Array} [options.format=a4] The format of the first page. Can be:<ul><li>a0 - a10</li><li>b0 - b10</li><li>c0 - c10</li><li>dl</li><li>letter</li><li>government-letter</li><li>legal</li><li>junior-legal</li><li>ledger</li><li>tabloid</li><li>credit-card</li></ul><br />\n * Default is \"a4\". If you want to use your own format just pass instead of one of the above predefined formats the size as an number-array, e.g. [595.28, 841.89]\n * @param {boolean} [options.putOnlyUsedFonts=false] Only put fonts into the PDF, which were used.\n * @param {boolean} [options.compress=false] Compress the generated PDF.\n * @param {number} [options.precision=16] Precision of the element-positions.\n * @param {number} [options.userUnit=1.0] Not to be confused with the base unit. Please inform yourself before you use it.\n * @param {number|\"smart\"} [options.floatPrecision=16]\n * @returns {jsPDF} jsPDF-instance\n * @description\n * ```\n * {\n *  orientation: 'p',\n *  unit: 'mm',\n *  format: 'a4',\n *  putOnlyUsedFonts:true,\n *  floatPrecision: 16 // or \"smart\", default is 16\n * }\n * ```\n *\n * @constructor\n */\nfunction jsPDF(options) {\n  var orientation = typeof arguments[0] === \"string\" ? arguments[0] : \"p\";\n  var unit = arguments[1];\n  var format = arguments[2];\n  var compressPdf = arguments[3];\n  var filters = [];\n  var userUnit = 1.0;\n  var precision;\n  var floatPrecision = 16;\n  var defaultPathOperation = \"S\";\n\n  options = options || {};\n\n  if (typeof options === \"object\") {\n    orientation = options.orientation;\n    unit = options.unit || unit;\n    format = options.format || format;\n    compressPdf = options.compress || options.compressPdf || compressPdf;\n    userUnit =\n      typeof options.userUnit === \"number\" ? Math.abs(options.userUnit) : 1.0;\n    if (typeof options.precision !== \"undefined\") {\n      precision = options.precision;\n    }\n    if (typeof options.floatPrecision !== \"undefined\") {\n      floatPrecision = options.floatPrecision;\n    }\n    defaultPathOperation = options.defaultPathOperation || \"S\";\n  }\n\n  filters =\n    options.filters || (compressPdf === true ? [\"FlateEncode\"] : filters);\n\n  unit = unit || \"mm\";\n  orientation = (\"\" + (orientation || \"P\")).toLowerCase();\n  var putOnlyUsedFonts = options.putOnlyUsedFonts || false;\n  var usedFonts = {};\n\n  var API = {\n    internal: {},\n    __private__: {}\n  };\n\n  API.__private__.PubSub = PubSub;\n\n  var pdfVersion = \"1.3\";\n  var getPdfVersion = (API.__private__.getPdfVersion = function() {\n    return pdfVersion;\n  });\n\n  API.__private__.setPdfVersion = function(value) {\n    pdfVersion = value;\n  };\n\n  // Size in pt of various paper formats\n  var pageFormats = {\n    a0: [2383.94, 3370.39],\n    a1: [1683.78, 2383.94],\n    a2: [1190.55, 1683.78],\n    a3: [841.89, 1190.55],\n    a4: [595.28, 841.89],\n    a5: [419.53, 595.28],\n    a6: [297.64, 419.53],\n    a7: [209.76, 297.64],\n    a8: [147.4, 209.76],\n    a9: [104.88, 147.4],\n    a10: [73.7, 104.88],\n    b0: [2834.65, 4008.19],\n    b1: [2004.09, 2834.65],\n    b2: [1417.32, 2004.09],\n    b3: [1000.63, 1417.32],\n    b4: [708.66, 1000.63],\n    b5: [498.9, 708.66],\n    b6: [354.33, 498.9],\n    b7: [249.45, 354.33],\n    b8: [175.75, 249.45],\n    b9: [124.72, 175.75],\n    b10: [87.87, 124.72],\n    c0: [2599.37, 3676.54],\n    c1: [1836.85, 2599.37],\n    c2: [1298.27, 1836.85],\n    c3: [918.43, 1298.27],\n    c4: [649.13, 918.43],\n    c5: [459.21, 649.13],\n    c6: [323.15, 459.21],\n    c7: [229.61, 323.15],\n    c8: [161.57, 229.61],\n    c9: [113.39, 161.57],\n    c10: [79.37, 113.39],\n    dl: [311.81, 623.62],\n    letter: [612, 792],\n    \"government-letter\": [576, 756],\n    legal: [612, 1008],\n    \"junior-legal\": [576, 360],\n    ledger: [1224, 792],\n    tabloid: [792, 1224],\n    \"credit-card\": [153, 243]\n  };\n\n  API.__private__.getPageFormats = function() {\n    return pageFormats;\n  };\n\n  var getPageFormat = (API.__private__.getPageFormat = function(value) {\n    return pageFormats[value];\n  });\n\n  format = format || \"a4\";\n\n  var ApiMode = {\n    COMPAT: \"compat\",\n    ADVANCED: \"advanced\"\n  };\n  var apiMode = ApiMode.COMPAT;\n\n  function advancedAPI() {\n    // prepend global change of basis matrix\n    // (Now, instead of converting every coordinate to the pdf coordinate system, we apply a matrix\n    // that does this job for us (however, texts, images and similar objects must be drawn bottom up))\n    this.saveGraphicsState();\n    out(\n      new Matrix(\n        scaleFactor,\n        0,\n        0,\n        -scaleFactor,\n        0,\n        getPageHeight() * scaleFactor\n      ).toString() + \" cm\"\n    );\n    this.setFontSize(this.getFontSize() / scaleFactor);\n\n    // The default in MrRio's implementation is \"S\" (stroke), whereas the default in the yWorks implementation\n    // was \"n\" (none). Although this has nothing to do with transforms, we should use the API switch here.\n    defaultPathOperation = \"n\";\n\n    apiMode = ApiMode.ADVANCED;\n  }\n\n  function compatAPI() {\n    this.restoreGraphicsState();\n    defaultPathOperation = \"S\";\n    apiMode = ApiMode.COMPAT;\n  }\n\n  /**\n   * @callback ApiSwitchBody\n   * @param {jsPDF} pdf\n   */\n\n  /**\n   * For compatibility reasons jsPDF offers two API modes which differ in the way they convert between the the usual\n   * screen coordinates and the PDF coordinate system.\n   *   - \"compat\": Offers full compatibility across all plugins but does not allow arbitrary transforms\n   *   - \"advanced\": Allows arbitrary transforms and more advanced features like pattern fills. Some plugins might\n   *     not support this mode, though.\n   * Initial mode is \"compat\".\n   *\n   * You can either provide a callback to the body argument, which means that jsPDF will automatically switch back to\n   * the original API mode afterwards; or you can omit the callback and switch back manually using {@link compatAPI}.\n   *\n   * Note, that the calls to {@link saveGraphicsState} and {@link restoreGraphicsState} need to be balanced within the\n   * callback or between calls of this method and its counterpart {@link compatAPI}. Calls to {@link beginFormObject}\n   * or {@link beginTilingPattern} need to be closed by their counterparts before switching back to \"compat\" API mode.\n   *\n   * @param {ApiSwitchBody=} body When provided, this callback will be called after the API mode has been switched.\n   * The API mode will be switched back automatically afterwards.\n   * @returns {jsPDF}\n   * @memberof jsPDF#\n   * @name advancedAPI\n   */\n  API.advancedAPI = function(body) {\n    var doSwitch = apiMode === ApiMode.COMPAT;\n\n    if (doSwitch) {\n      advancedAPI.call(this);\n    }\n\n    if (typeof body !== \"function\") {\n      return this;\n    }\n\n    body(this);\n\n    if (doSwitch) {\n      compatAPI.call(this);\n    }\n\n    return this;\n  };\n\n  /**\n   * Switches to \"compat\" API mode. See {@link advancedAPI} for more details.\n   *\n   * @param {ApiSwitchBody=} body When provided, this callback will be called after the API mode has been switched.\n   * The API mode will be switched back automatically afterwards.\n   * @return {jsPDF}\n   * @memberof jsPDF#\n   * @name compatApi\n   */\n  API.compatAPI = function(body) {\n    var doSwitch = apiMode === ApiMode.ADVANCED;\n\n    if (doSwitch) {\n      compatAPI.call(this);\n    }\n\n    if (typeof body !== \"function\") {\n      return this;\n    }\n\n    body(this);\n\n    if (doSwitch) {\n      advancedAPI.call(this);\n    }\n\n    return this;\n  };\n\n  /**\n   * @return {boolean} True iff the current API mode is \"advanced\". See {@link advancedAPI}.\n   * @memberof jsPDF#\n   * @name isAdvancedAPI\n   */\n  API.isAdvancedAPI = function() {\n    return apiMode === ApiMode.ADVANCED;\n  };\n\n  var advancedApiModeTrap = function(methodName) {\n    if (apiMode !== ApiMode.ADVANCED) {\n      throw new Error(\n        methodName +\n          \" is only available in 'advanced' API mode. \" +\n          \"You need to call advancedAPI() first.\"\n      );\n    }\n  };\n\n  var roundToPrecision = (API.roundToPrecision = API.__private__.roundToPrecision = function(\n    number,\n    parmPrecision\n  ) {\n    var tmpPrecision = precision || parmPrecision;\n    if (isNaN(number) || isNaN(tmpPrecision)) {\n      throw new Error(\"Invalid argument passed to jsPDF.roundToPrecision\");\n    }\n    return number.toFixed(tmpPrecision).replace(/0+$/, \"\");\n  });\n\n  // high precision float\n  var hpf;\n  if (typeof floatPrecision === \"number\") {\n    hpf = API.hpf = API.__private__.hpf = function(number) {\n      if (isNaN(number)) {\n        throw new Error(\"Invalid argument passed to jsPDF.hpf\");\n      }\n      return roundToPrecision(number, floatPrecision);\n    };\n  } else if (floatPrecision === \"smart\") {\n    hpf = API.hpf = API.__private__.hpf = function(number) {\n      if (isNaN(number)) {\n        throw new Error(\"Invalid argument passed to jsPDF.hpf\");\n      }\n      if (number > -1 && number < 1) {\n        return roundToPrecision(number, 16);\n      } else {\n        return roundToPrecision(number, 5);\n      }\n    };\n  } else {\n    hpf = API.hpf = API.__private__.hpf = function(number) {\n      if (isNaN(number)) {\n        throw new Error(\"Invalid argument passed to jsPDF.hpf\");\n      }\n      return roundToPrecision(number, 16);\n    };\n  }\n  var f2 = (API.f2 = API.__private__.f2 = function(number) {\n    if (isNaN(number)) {\n      throw new Error(\"Invalid argument passed to jsPDF.f2\");\n    }\n    return roundToPrecision(number, 2);\n  });\n\n  var f3 = (API.__private__.f3 = function(number) {\n    if (isNaN(number)) {\n      throw new Error(\"Invalid argument passed to jsPDF.f3\");\n    }\n    return roundToPrecision(number, 3);\n  });\n\n  var scale = (API.scale = API.__private__.scale = function(number) {\n    if (isNaN(number)) {\n      throw new Error(\"Invalid argument passed to jsPDF.scale\");\n    }\n    if (apiMode === ApiMode.COMPAT) {\n      return number * scaleFactor;\n    } else if (apiMode === ApiMode.ADVANCED) {\n      return number;\n    }\n  });\n\n  var transformY = function(y) {\n    if (apiMode === ApiMode.COMPAT) {\n      return getPageHeight() - y;\n    } else if (apiMode === ApiMode.ADVANCED) {\n      return y;\n    }\n  };\n\n  var transformScaleY = function(y) {\n    return scale(transformY(y));\n  };\n\n  /**\n   * @name setPrecision\n   * @memberof jsPDF#\n   * @function\n   * @instance\n   * @param {string} precision\n   * @returns {jsPDF}\n   */\n  API.__private__.setPrecision = API.setPrecision = function(value) {\n    if (typeof parseInt(value, 10) === \"number\") {\n      precision = parseInt(value, 10);\n    }\n  };\n\n  var fileId = \"00000000000000000000000000000000\";\n\n  var getFileId = (API.__private__.getFileId = function() {\n    return fileId;\n  });\n\n  var setFileId = (API.__private__.setFileId = function(value) {\n    if (typeof value !== \"undefined\" && /^[a-fA-F0-9]{32}$/.test(value)) {\n      fileId = value.toUpperCase();\n    } else {\n      fileId = fileId\n        .split(\"\")\n        .map(function() {\n          return \"ABCDEF0123456789\".charAt(Math.floor(Math.random() * 16));\n        })\n        .join(\"\");\n    }\n    return fileId;\n  });\n\n  /**\n   * @name setFileId\n   * @memberof jsPDF#\n   * @function\n   * @instance\n   * @param {string} value GUID.\n   * @returns {jsPDF}\n   */\n  API.setFileId = function(value) {\n    setFileId(value);\n    return this;\n  };\n\n  /**\n   * @name getFileId\n   * @memberof jsPDF#\n   * @function\n   * @instance\n   *\n   * @returns {string} GUID.\n   */\n  API.getFileId = function() {\n    return getFileId();\n  };\n\n  var creationDate;\n\n  var convertDateToPDFDate = (API.__private__.convertDateToPDFDate = function(\n    parmDate\n  ) {\n    var result = \"\";\n    var tzoffset = parmDate.getTimezoneOffset(),\n      tzsign = tzoffset < 0 ? \"+\" : \"-\",\n      tzhour = Math.floor(Math.abs(tzoffset / 60)),\n      tzmin = Math.abs(tzoffset % 60),\n      timeZoneString = [tzsign, padd2(tzhour), \"'\", padd2(tzmin), \"'\"].join(\"\");\n\n    result = [\n      \"D:\",\n      parmDate.getFullYear(),\n      padd2(parmDate.getMonth() + 1),\n      padd2(parmDate.getDate()),\n      padd2(parmDate.getHours()),\n      padd2(parmDate.getMinutes()),\n      padd2(parmDate.getSeconds()),\n      timeZoneString\n    ].join(\"\");\n    return result;\n  });\n\n  var convertPDFDateToDate = (API.__private__.convertPDFDateToDate = function(\n    parmPDFDate\n  ) {\n    var year = parseInt(parmPDFDate.substr(2, 4), 10);\n    var month = parseInt(parmPDFDate.substr(6, 2), 10) - 1;\n    var date = parseInt(parmPDFDate.substr(8, 2), 10);\n    var hour = parseInt(parmPDFDate.substr(10, 2), 10);\n    var minutes = parseInt(parmPDFDate.substr(12, 2), 10);\n    var seconds = parseInt(parmPDFDate.substr(14, 2), 10);\n    // var timeZoneHour = parseInt(parmPDFDate.substr(16, 2), 10);\n    // var timeZoneMinutes = parseInt(parmPDFDate.substr(20, 2), 10);\n\n    var resultingDate = new Date(year, month, date, hour, minutes, seconds, 0);\n    return resultingDate;\n  });\n\n  var setCreationDate = (API.__private__.setCreationDate = function(date) {\n    var tmpCreationDateString;\n    var regexPDFCreationDate = /^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\\+0[0-9]|\\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/;\n    if (typeof date === \"undefined\") {\n      date = new Date();\n    }\n\n    if (date instanceof Date) {\n      tmpCreationDateString = convertDateToPDFDate(date);\n    } else if (regexPDFCreationDate.test(date)) {\n      tmpCreationDateString = date;\n    } else {\n      throw new Error(\"Invalid argument passed to jsPDF.setCreationDate\");\n    }\n    creationDate = tmpCreationDateString;\n    return creationDate;\n  });\n\n  var getCreationDate = (API.__private__.getCreationDate = function(type) {\n    var result = creationDate;\n    if (type === \"jsDate\") {\n      result = convertPDFDateToDate(creationDate);\n    }\n    return result;\n  });\n\n  /**\n   * @name setCreationDate\n   * @memberof jsPDF#\n   * @function\n   * @instance\n   * @param {Object} date\n   * @returns {jsPDF}\n   */\n  API.setCreationDate = function(date) {\n    setCreationDate(date);\n    return this;\n  };\n\n  /**\n   * @name getCreationDate\n   * @memberof jsPDF#\n   * @function\n   * @instance\n   * @param {Object} type\n   * @returns {Object}\n   */\n  API.getCreationDate = function(type) {\n    return getCreationDate(type);\n  };\n\n  var padd2 = (API.__private__.padd2 = function(number) {\n    return (\"0\" + parseInt(number)).slice(-2);\n  });\n\n  var padd2Hex = (API.__private__.padd2Hex = function(hexString) {\n    hexString = hexString.toString();\n    return (\"00\" + hexString).substr(hexString.length);\n  });\n\n  var objectNumber = 0; // 'n' Current object number\n  var offsets = []; // List of offsets. Activated and reset by buildDocument(). Pupulated by various calls buildDocument makes.\n  var content = [];\n  var contentLength = 0;\n  var additionalObjects = [];\n\n  var pages = [];\n  var currentPage;\n  var hasCustomDestination = false;\n  var outputDestination = content;\n\n  var resetDocument = function() {\n    //reset fields relevant for objectNumber generation and xref.\n    objectNumber = 0;\n    contentLength = 0;\n    content = [];\n    offsets = [];\n    additionalObjects = [];\n\n    rootDictionaryObjId = newObjectDeferred();\n    resourceDictionaryObjId = newObjectDeferred();\n  };\n\n  API.__private__.setCustomOutputDestination = function(destination) {\n    hasCustomDestination = true;\n    outputDestination = destination;\n  };\n  var setOutputDestination = function(destination) {\n    if (!hasCustomDestination) {\n      outputDestination = destination;\n    }\n  };\n\n  API.__private__.resetCustomOutputDestination = function() {\n    hasCustomDestination = false;\n    outputDestination = content;\n  };\n\n  var out = (API.__private__.out = function(string) {\n    string = string.toString();\n    contentLength += string.length + 1;\n    outputDestination.push(string);\n\n    return outputDestination;\n  });\n\n  var write = (API.__private__.write = function(value) {\n    return out(\n      arguments.length === 1\n        ? value.toString()\n        : Array.prototype.join.call(arguments, \" \")\n    );\n  });\n\n  var getArrayBuffer = (API.__private__.getArrayBuffer = function(data) {\n    var len = data.length,\n      ab = new ArrayBuffer(len),\n      u8 = new Uint8Array(ab);\n\n    while (len--) u8[len] = data.charCodeAt(len);\n    return ab;\n  });\n\n  var standardFonts = [\n    [\"Helvetica\", \"helvetica\", \"normal\", \"WinAnsiEncoding\"],\n    [\"Helvetica-Bold\", \"helvetica\", \"bold\", \"WinAnsiEncoding\"],\n    [\"Helvetica-Oblique\", \"helvetica\", \"italic\", \"WinAnsiEncoding\"],\n    [\"Helvetica-BoldOblique\", \"helvetica\", \"bolditalic\", \"WinAnsiEncoding\"],\n    [\"Courier\", \"courier\", \"normal\", \"WinAnsiEncoding\"],\n    [\"Courier-Bold\", \"courier\", \"bold\", \"WinAnsiEncoding\"],\n    [\"Courier-Oblique\", \"courier\", \"italic\", \"WinAnsiEncoding\"],\n    [\"Courier-BoldOblique\", \"courier\", \"bolditalic\", \"WinAnsiEncoding\"],\n    [\"Times-Roman\", \"times\", \"normal\", \"WinAnsiEncoding\"],\n    [\"Times-Bold\", \"times\", \"bold\", \"WinAnsiEncoding\"],\n    [\"Times-Italic\", \"times\", \"italic\", \"WinAnsiEncoding\"],\n    [\"Times-BoldItalic\", \"times\", \"bolditalic\", \"WinAnsiEncoding\"],\n    [\"ZapfDingbats\", \"zapfdingbats\", \"normal\", null],\n    [\"Symbol\", \"symbol\", \"normal\", null]\n  ];\n\n  API.__private__.getStandardFonts = function() {\n    return standardFonts;\n  };\n\n  var activeFontSize = options.fontSize || 16;\n\n  /**\n   * Sets font size for upcoming text elements.\n   *\n   * @param {number} size Font size in points.\n   * @function\n   * @instance\n   * @returns {jsPDF}\n   * @memberof jsPDF#\n   * @name setFontSize\n   */\n  API.__private__.setFontSize = API.setFontSize = function(size) {\n    if (apiMode === ApiMode.ADVANCED) {\n      activeFontSize = size / scaleFactor;\n    } else {\n      activeFontSize = size;\n    }\n    return this;\n  };\n\n  /**\n   * Gets the fontsize for upcoming text elements.\n   *\n   * @function\n   * @instance\n   * @returns {number}\n   * @memberof jsPDF#\n   * @name getFontSize\n   */\n  var getFontSize = (API.__private__.getFontSize = API.getFontSize = function() {\n    if (apiMode === ApiMode.COMPAT) {\n      return activeFontSize;\n    } else {\n      return activeFontSize * scaleFactor;\n    }\n  });\n\n  var R2L = options.R2L || false;\n\n  /**\n   * Set value of R2L functionality.\n   *\n   * @param {boolean} value\n   * @function\n   * @instance\n   * @returns {jsPDF} jsPDF-instance\n   * @memberof jsPDF#\n   * @name setR2L\n   */\n  API.__private__.setR2L = API.setR2L = function(value) {\n    R2L = value;\n    return this;\n  };\n\n  /**\n   * Get value of R2L functionality.\n   *\n   * @function\n   * @instance\n   * @returns {boolean} jsPDF-instance\n   * @memberof jsPDF#\n   * @name getR2L\n   */\n  API.__private__.getR2L = API.getR2L = function() {\n    return R2L;\n  };\n\n  var zoomMode; // default: 1;\n\n  var setZoomMode = (API.__private__.setZoomMode = function(zoom) {\n    var validZoomModes = [\n      undefined,\n      null,\n      \"fullwidth\",\n      \"fullheight\",\n      \"fullpage\",\n      \"original\"\n    ];\n\n    if (/^\\d*\\.?\\d*%$/.test(zoom)) {\n      zoomMode = zoom;\n    } else if (!isNaN(zoom)) {\n      zoomMode = parseInt(zoom, 10);\n    } else if (validZoomModes.indexOf(zoom) !== -1) {\n      zoomMode = zoom;\n    } else {\n      throw new Error(\n        'zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. \"' +\n          zoom +\n          '\" is not recognized.'\n      );\n    }\n  });\n\n  API.__private__.getZoomMode = function() {\n    return zoomMode;\n  };\n\n  var pageMode; // default: 'UseOutlines';\n  var setPageMode = (API.__private__.setPageMode = function(pmode) {\n    var validPageModes = [\n      undefined,\n      null,\n      \"UseNone\",\n      \"UseOutlines\",\n      \"UseThumbs\",\n      \"FullScreen\"\n    ];\n\n    if (validPageModes.indexOf(pmode) == -1) {\n      throw new Error(\n        'Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. \"' +\n          pmode +\n          '\" is not recognized.'\n      );\n    }\n    pageMode = pmode;\n  });\n\n  API.__private__.getPageMode = function() {\n    return pageMode;\n  };\n\n  var layoutMode; // default: 'continuous';\n  var setLayoutMode = (API.__private__.setLayoutMode = function(layout) {\n    var validLayoutModes = [\n      undefined,\n      null,\n      \"continuous\",\n      \"single\",\n      \"twoleft\",\n      \"tworight\",\n      \"two\"\n    ];\n\n    if (validLayoutModes.indexOf(layout) == -1) {\n      throw new Error(\n        'Layout mode must be one of continuous, single, twoleft, tworight. \"' +\n          layout +\n          '\" is not recognized.'\n      );\n    }\n    layoutMode = layout;\n  });\n\n  API.__private__.getLayoutMode = function() {\n    return layoutMode;\n  };\n\n  /**\n   * Set the display mode options of the page like zoom and layout.\n   *\n   * @name setDisplayMode\n   * @memberof jsPDF#\n   * @function\n   * @instance\n   * @param {integer|String} zoom   You can pass an integer or percentage as\n   * a string. 2 will scale the document up 2x, '200%' will scale up by the\n   * same amount. You can also set it to 'fullwidth', 'fullheight',\n   * 'fullpage', or 'original'.\n   *\n   * Only certain PDF readers support this, such as Adobe Acrobat.\n   *\n   * @param {string} layout Layout mode can be: 'continuous' - this is the\n   * default continuous scroll. 'single' - the single page mode only shows one\n   * page at a time. 'twoleft' - two column left mode, first page starts on\n   * the left, and 'tworight' - pages are laid out in two columns, with the\n   * first page on the right. This would be used for books.\n   * @param {string} pmode 'UseOutlines' - it shows the\n   * outline of the document on the left. 'UseThumbs' - shows thumbnails along\n   * the left. 'FullScreen' - prompts the user to enter fullscreen mode.\n   *\n   * @returns {jsPDF}\n   */\n  API.__private__.setDisplayMode = API.setDisplayMode = function(\n    zoom,\n    layout,\n    pmode\n  ) {\n    setZoomMode(zoom);\n    setLayoutMode(layout);\n    setPageMode(pmode);\n    return this;\n  };\n\n  var documentProperties = {\n    title: \"\",\n    subject: \"\",\n    author: \"\",\n    keywords: \"\",\n    creator: \"\"\n  };\n\n  API.__private__.getDocumentProperty = function(key) {\n    if (Object.keys(documentProperties).indexOf(key) === -1) {\n      throw new Error(\"Invalid argument passed to jsPDF.getDocumentProperty\");\n    }\n    return documentProperties[key];\n  };\n\n  API.__private__.getDocumentProperties = function() {\n    return documentProperties;\n  };\n\n  /**\n   * Adds a properties to the PDF document.\n   *\n   * @param {Object} A property_name-to-property_value object structure.\n   * @function\n   * @instance\n   * @returns {jsPDF}\n   * @memberof jsPDF#\n   * @name setDocumentProperties\n   */\n  API.__private__.setDocumentProperties = API.setProperties = API.setDocumentProperties = function(\n    properties\n  ) {\n    // copying only those properties we can render.\n    for (var property in documentProperties) {\n      if (documentProperties.hasOwnProperty(property) && properties[property]) {\n        documentProperties[property] = properties[property];\n      }\n    }\n    return this;\n  };\n\n  API.__private__.setDocumentProperty = function(key, value) {\n    if (Object.keys(documentProperties).indexOf(key) === -1) {\n      throw new Error(\"Invalid arguments passed to jsPDF.setDocumentProperty\");\n    }\n    return (documentProperties[key] = value);\n  };\n\n  var fonts = {}; // collection of font objects, where key is fontKey - a dynamically created label for a given font.\n  var fontmap = {}; // mapping structure fontName > fontStyle > font key - performance layer. See addFont()\n  var activeFontKey; // will be string representing the KEY of the font as combination of fontName + fontStyle\n  var fontStateStack = []; //\n  var patterns = {}; // collection of pattern objects\n  var patternMap = {}; // see fonts\n  var gStates = {}; // collection of graphic state objects\n  var gStatesMap = {}; // see fonts\n  var activeGState = null;\n  var scaleFactor; // Scale factor\n  var page = 0;\n  var pagesContext = [];\n  var events = new PubSub(API);\n  var hotfixes = options.hotfixes || [];\n\n  var renderTargets = {};\n  var renderTargetMap = {};\n  var renderTargetStack = [];\n  var pageX;\n  var pageY;\n  var pageMatrix; // only used for FormObjects\n\n  /**\n   * A matrix object for 2D homogenous transformations: <br>\n   * | a b 0 | <br>\n   * | c d 0 | <br>\n   * | e f 1 | <br>\n   * pdf multiplies matrices righthand: v' = v x m1 x m2 x ...\n   *\n   * @class\n   * @name Matrix\n   * @param {number} sx\n   * @param {number} shy\n   * @param {number} shx\n   * @param {number} sy\n   * @param {number} tx\n   * @param {number} ty\n   * @constructor\n   */\n  var Matrix = function(sx, shy, shx, sy, tx, ty) {\n    if (!(this instanceof Matrix)) {\n      return new Matrix(sx, shy, shx, sy, tx, ty);\n    }\n\n    if (isNaN(sx)) sx = 1;\n    if (isNaN(shy)) shy = 0;\n    if (isNaN(shx)) shx = 0;\n    if (isNaN(sy)) sy = 1;\n    if (isNaN(tx)) tx = 0;\n    if (isNaN(ty)) ty = 0;\n\n    this._matrix = [sx, shy, shx, sy, tx, ty];\n  };\n\n  /**\n   * @name sx\n   * @memberof Matrix#\n   */\n  Object.defineProperty(Matrix.prototype, \"sx\", {\n    get: function() {\n      return this._matrix[0];\n    },\n    set: function(value) {\n      this._matrix[0] = value;\n    }\n  });\n\n  /**\n   * @name shy\n   * @memberof Matrix#\n   */\n  Object.defineProperty(Matrix.prototype, \"shy\", {\n    get: function() {\n      return this._matrix[1];\n    },\n    set: function(value) {\n      this._matrix[1] = value;\n    }\n  });\n\n  /**\n   * @name shx\n   * @memberof Matrix#\n   */\n  Object.defineProperty(Matrix.prototype, \"shx\", {\n    get: function() {\n      return this._matrix[2];\n    },\n    set: function(value) {\n      this._matrix[2] = value;\n    }\n  });\n\n  /**\n   * @name sy\n   * @memberof Matrix#\n   */\n  Object.defineProperty(Matrix.prototype, \"sy\", {\n    get: function() {\n      return this._matrix[3];\n    },\n    set: function(value) {\n      this._matrix[3] = value;\n    }\n  });\n\n  /**\n   * @name tx\n   * @memberof Matrix#\n   */\n  Object.defineProperty(Matrix.prototype, \"tx\", {\n    get: function() {\n      return this._matrix[4];\n    },\n    set: function(value) {\n      this._matrix[4] = value;\n    }\n  });\n\n  /**\n   * @name ty\n   * @memberof Matrix#\n   */\n  Object.defineProperty(Matrix.prototype, \"ty\", {\n    get: function() {\n      return this._matrix[5];\n    },\n    set: function(value) {\n      this._matrix[5] = value;\n    }\n  });\n\n  Object.defineProperty(Matrix.prototype, \"a\", {\n    get: function() {\n      return this._matrix[0];\n    },\n    set: function(value) {\n      this._matrix[0] = value;\n    }\n  });\n\n  Object.defineProperty(Matrix.prototype, \"b\", {\n    get: function() {\n      return this._matrix[1];\n    },\n    set: function(value) {\n      this._matrix[1] = value;\n    }\n  });\n\n  Object.defineProperty(Matrix.prototype, \"c\", {\n    get: function() {\n      return this._matrix[2];\n    },\n    set: function(value) {\n      this._matrix[2] = value;\n    }\n  });\n\n  Object.defineProperty(Matrix.prototype, \"d\", {\n    get: function() {\n      return this._matrix[3];\n    },\n    set: function(value) {\n      this._matrix[3] = value;\n    }\n  });\n\n  Object.defineProperty(Matrix.prototype, \"e\", {\n    get: function() {\n      return this._matrix[4];\n    },\n    set: function(value) {\n      this._matrix[4] = value;\n    }\n  });\n\n  Object.defineProperty(Matrix.prototype, \"f\", {\n    get: function() {\n      return this._matrix[5];\n    },\n    set: function(value) {\n      this._matrix[5] = value;\n    }\n  });\n\n  /**\n   * @name rotation\n   * @memberof Matrix#\n   */\n  Object.defineProperty(Matrix.prototype, \"rotation\", {\n    get: function() {\n      return Math.atan2(this.shx, this.sx);\n    }\n  });\n\n  /**\n   * @name scaleX\n   * @memberof Matrix#\n   */\n  Object.defineProperty(Matrix.prototype, \"scaleX\", {\n    get: function() {\n      return this.decompose().scale.sx;\n    }\n  });\n\n  /**\n   * @name scaleY\n   * @memberof Matrix#\n   */\n  Object.defineProperty(Matrix.prototype, \"scaleY\", {\n    get: function() {\n      return this.decompose().scale.sy;\n    }\n  });\n\n  /**\n   * @name isIdentity\n   * @memberof Matrix#\n   */\n  Object.defineProperty(Matrix.prototype, \"isIdentity\", {\n    get: function() {\n      if (this.sx !== 1) {\n        return false;\n      }\n      if (this.shy !== 0) {\n        return false;\n      }\n      if (this.shx !== 0) {\n        return false;\n      }\n      if (this.sy !== 1) {\n        return false;\n      }\n      if (this.tx !== 0) {\n        return false;\n      }\n      if (this.ty !== 0) {\n        return false;\n      }\n      return true;\n    }\n  });\n\n  /**\n   * Join the Matrix Values to a String\n   *\n   * @function join\n   * @param {string} separator Specifies a string to separate each pair of adjacent elements of the array. The separator is converted to a string if necessary. If omitted, the array elements are separated with a comma (\",\"). If separator is an empty string, all elements are joined without any characters in between them.\n   * @returns {string} A string with all array elements joined.\n   * @memberof Matrix#\n   */\n  Matrix.prototype.join = function(separator) {\n    return [this.sx, this.shy, this.shx, this.sy, this.tx, this.ty]\n      .map(hpf)\n      .join(separator);\n  };\n\n  /**\n   * Multiply the matrix with given Matrix\n   *\n   * @function multiply\n   * @param matrix\n   * @returns {Matrix}\n   * @memberof Matrix#\n   */\n  Matrix.prototype.multiply = function(matrix) {\n    var sx = matrix.sx * this.sx + matrix.shy * this.shx;\n    var shy = matrix.sx * this.shy + matrix.shy * this.sy;\n    var shx = matrix.shx * this.sx + matrix.sy * this.shx;\n    var sy = matrix.shx * this.shy + matrix.sy * this.sy;\n    var tx = matrix.tx * this.sx + matrix.ty * this.shx + this.tx;\n    var ty = matrix.tx * this.shy + matrix.ty * this.sy + this.ty;\n\n    return new Matrix(sx, shy, shx, sy, tx, ty);\n  };\n\n  /**\n   * @function decompose\n   * @memberof Matrix#\n   */\n  Matrix.prototype.decompose = function() {\n    var a = this.sx;\n    var b = this.shy;\n    var c = this.shx;\n    var d = this.sy;\n    var e = this.tx;\n    var f = this.ty;\n\n    var scaleX = Math.sqrt(a * a + b * b);\n    a /= scaleX;\n    b /= scaleX;\n\n    var shear = a * c + b * d;\n    c -= a * shear;\n    d -= b * shear;\n\n    var scaleY = Math.sqrt(c * c + d * d);\n    c /= scaleY;\n    d /= scaleY;\n    shear /= scaleY;\n\n    if (a * d < b * c) {\n      a = -a;\n      b = -b;\n      shear = -shear;\n      scaleX = -scaleX;\n    }\n\n    return {\n      scale: new Matrix(scaleX, 0, 0, scaleY, 0, 0),\n      translate: new Matrix(1, 0, 0, 1, e, f),\n      rotate: new Matrix(a, b, -b, a, 0, 0),\n      skew: new Matrix(1, 0, shear, 1, 0, 0)\n    };\n  };\n\n  /**\n   * @function toString\n   * @memberof Matrix#\n   */\n  Matrix.prototype.toString = function(parmPrecision) {\n    return this.join(\" \");\n  };\n\n  /**\n   * @function inversed\n   * @memberof Matrix#\n   */\n  Matrix.prototype.inversed = function() {\n    var a = this.sx,\n      b = this.shy,\n      c = this.shx,\n      d = this.sy,\n      e = this.tx,\n      f = this.ty;\n\n    var quot = 1 / (a * d - b * c);\n\n    var aInv = d * quot;\n    var bInv = -b * quot;\n    var cInv = -c * quot;\n    var dInv = a * quot;\n    var eInv = -aInv * e - cInv * f;\n    var fInv = -bInv * e - dInv * f;\n\n    return new Matrix(aInv, bInv, cInv, dInv, eInv, fInv);\n  };\n\n  /**\n   * @function applyToPoint\n   * @memberof Matrix#\n   */\n  Matrix.prototype.applyToPoint = function(pt) {\n    var x = pt.x * this.sx + pt.y * this.shx + this.tx;\n    var y = pt.x * this.shy + pt.y * this.sy + this.ty;\n    return new Point(x, y);\n  };\n\n  /**\n   * @function applyToRectangle\n   * @memberof Matrix#\n   */\n  Matrix.prototype.applyToRectangle = function(rect) {\n    var pt1 = this.applyToPoint(rect);\n    var pt2 = this.applyToPoint(new Point(rect.x + rect.w, rect.y + rect.h));\n    return new Rectangle(pt1.x, pt1.y, pt2.x - pt1.x, pt2.y - pt1.y);\n  };\n\n  /**\n   * Clone the Matrix\n   *\n   * @function clone\n   * @memberof Matrix#\n   * @name clone\n   * @instance\n   */\n  Matrix.prototype.clone = function() {\n    var sx = this.sx;\n    var shy = this.shy;\n    var shx = this.shx;\n    var sy = this.sy;\n    var tx = this.tx;\n    var ty = this.ty;\n\n    return new Matrix(sx, shy, shx, sy, tx, ty);\n  };\n\n  API.Matrix = Matrix;\n\n  /**\n   * Multiplies two matrices. (see {@link Matrix})\n   * @param {Matrix} m1\n   * @param {Matrix} m2\n   * @memberof jsPDF#\n   * @name matrixMult\n   */\n  var matrixMult = (API.matrixMult = function(m1, m2) {\n    return m2.multiply(m1);\n  });\n\n  /**\n   * The identity matrix (equivalent to new Matrix(1, 0, 0, 1, 0, 0)).\n   * @type {Matrix}\n   * @memberof! jsPDF#\n   * @name identityMatrix\n   */\n  var identityMatrix = new Matrix(1, 0, 0, 1, 0, 0);\n  API.unitMatrix = API.identityMatrix = identityMatrix;\n\n  /**\n   * Adds a new pattern for later use.\n   * @param {String} key The key by it can be referenced later. The keys must be unique!\n   * @param {API.Pattern} pattern The pattern\n   */\n  var addPattern = function(key, pattern) {\n    // only add it if it is not already present (the keys provided by the user must be unique!)\n    if (patternMap[key]) return;\n\n    var prefix = pattern instanceof ShadingPattern ? \"Sh\" : \"P\";\n    var patternKey = prefix + (Object.keys(patterns).length + 1).toString(10);\n    pattern.id = patternKey;\n\n    patternMap[key] = patternKey;\n    patterns[patternKey] = pattern;\n\n    events.publish(\"addPattern\", pattern);\n  };\n\n  /**\n   * A pattern describing a shading pattern.\n   *\n   * Only available in \"advanced\" API mode.\n   *\n   * @param {String} type One of \"axial\" or \"radial\"\n   * @param {Array<Number>} coords Either [x1, y1, x2, y2] for \"axial\" type describing the two interpolation points\n   * or [x1, y1, r, x2, y2, r2] for \"radial\" describing inner and the outer circle.\n   * @param {Array<Object>} colors An array of objects with the fields \"offset\" and \"color\". \"offset\" describes\n   * the offset in parameter space [0, 1]. \"color\" is an array of length 3 describing RGB values in [0, 255].\n   * @param {GState=} gState An additional graphics state that gets applied to the pattern (optional).\n   * @param {Matrix=} matrix A matrix that describes the transformation between the pattern coordinate system\n   * and the use coordinate system (optional).\n   * @constructor\n   * @extends API.Pattern\n   */\n  API.ShadingPattern = ShadingPattern;\n\n  /**\n   * A PDF Tiling pattern.\n   *\n   * Only available in \"advanced\" API mode.\n   *\n   * @param {Array.<Number>} boundingBox The bounding box at which one pattern cell gets clipped.\n   * @param {Number} xStep Horizontal spacing between pattern cells.\n   * @param {Number} yStep Vertical spacing between pattern cells.\n   * @param {API.GState=} gState An additional graphics state that gets applied to the pattern (optional).\n   * @param {Matrix=} matrix A matrix that describes the transformation between the pattern coordinate system\n   * and the use coordinate system (optional).\n   * @constructor\n   * @extends API.Pattern\n   */\n  API.TilingPattern = TilingPattern;\n\n  /**\n   * Adds a new {@link API.ShadingPattern} for later use. Only available in \"advanced\" API mode.\n   * @param {String} key\n   * @param {Pattern} pattern\n   * @function\n   * @returns {jsPDF}\n   * @memberof jsPDF#\n   * @name addPattern\n   */\n  API.addShadingPattern = function(key, pattern) {\n    advancedApiModeTrap(\"addShadingPattern()\");\n\n    addPattern(key, pattern);\n    return this;\n  };\n\n  /**\n   * Begins a new tiling pattern. All subsequent render calls are drawn to this pattern until {@link API.endTilingPattern}\n   * gets called. Only available in \"advanced\" API mode.\n   * @param {API.Pattern} pattern\n   * @memberof jsPDF#\n   * @name beginTilingPattern\n   */\n  API.beginTilingPattern = function(pattern) {\n    advancedApiModeTrap(\"beginTilingPattern()\");\n\n    beginNewRenderTarget(\n      pattern.boundingBox[0],\n      pattern.boundingBox[1],\n      pattern.boundingBox[2] - pattern.boundingBox[0],\n      pattern.boundingBox[3] - pattern.boundingBox[1],\n      pattern.matrix\n    );\n  };\n\n  /**\n   * Ends a tiling pattern and sets the render target to the one active before {@link API.beginTilingPattern} has been called.\n   *\n   * Only available in \"advanced\" API mode.\n   *\n   * @param {string} key A unique key that is used to reference this pattern at later use.\n   * @param {API.Pattern} pattern The pattern to end.\n   * @memberof jsPDF#\n   * @name endTilingPattern\n   */\n  API.endTilingPattern = function(key, pattern) {\n    advancedApiModeTrap(\"endTilingPattern()\");\n\n    // retrieve the stream\n    pattern.stream = pages[currentPage].join(\"\\n\");\n\n    addPattern(key, pattern);\n\n    events.publish(\"endTilingPattern\", pattern);\n\n    // restore state from stack\n    renderTargetStack.pop().restore();\n  };\n\n  var newObject = (API.__private__.newObject = function() {\n    var oid = newObjectDeferred();\n    newObjectDeferredBegin(oid, true);\n    return oid;\n  });\n\n  // Does not output the object.  The caller must call newObjectDeferredBegin(oid) before outputing any data\n  var newObjectDeferred = (API.__private__.newObjectDeferred = function() {\n    objectNumber++;\n    offsets[objectNumber] = function() {\n      return contentLength;\n    };\n    return objectNumber;\n  });\n\n  var newObjectDeferredBegin = function(oid, doOutput) {\n    doOutput = typeof doOutput === \"boolean\" ? doOutput : false;\n    offsets[oid] = contentLength;\n    if (doOutput) {\n      out(oid + \" 0 obj\");\n    }\n    return oid;\n  };\n  // Does not output the object until after the pages have been output.\n  // Returns an object containing the objectId and content.\n  // All pages have been added so the object ID can be estimated to start right after.\n  // This does not modify the current objectNumber;  It must be updated after the newObjects are output.\n  var newAdditionalObject = (API.__private__.newAdditionalObject = function() {\n    var objId = newObjectDeferred();\n    var obj = {\n      objId: objId,\n      content: \"\"\n    };\n    additionalObjects.push(obj);\n    return obj;\n  });\n\n  var rootDictionaryObjId = newObjectDeferred();\n  var resourceDictionaryObjId = newObjectDeferred();\n\n  /////////////////////\n  // Private functions\n  /////////////////////\n\n  var decodeColorString = (API.__private__.decodeColorString = function(color) {\n    var colorEncoded = color.split(\" \");\n    if (\n      colorEncoded.length === 2 &&\n      (colorEncoded[1] === \"g\" || colorEncoded[1] === \"G\")\n    ) {\n      // convert grayscale value to rgb so that it can be converted to hex for consistency\n      var floatVal = parseFloat(colorEncoded[0]);\n      colorEncoded = [floatVal, floatVal, floatVal, \"r\"];\n    } else if (\n      colorEncoded.length === 5 &&\n      (colorEncoded[4] === \"k\" || colorEncoded[4] === \"K\")\n    ) {\n      // convert CMYK values to rbg so that it can be converted to hex for consistency\n      var red = (1.0 - colorEncoded[0]) * (1.0 - colorEncoded[3]);\n      var green = (1.0 - colorEncoded[1]) * (1.0 - colorEncoded[3]);\n      var blue = (1.0 - colorEncoded[2]) * (1.0 - colorEncoded[3]);\n\n      colorEncoded = [red, green, blue, \"r\"];\n    }\n    var colorAsRGB = \"#\";\n    for (var i = 0; i < 3; i++) {\n      colorAsRGB += (\n        \"0\" + Math.floor(parseFloat(colorEncoded[i]) * 255).toString(16)\n      ).slice(-2);\n    }\n    return colorAsRGB;\n  });\n\n  var encodeColorString = (API.__private__.encodeColorString = function(\n    options\n  ) {\n    var color;\n\n    if (typeof options === \"string\") {\n      options = {\n        ch1: options\n      };\n    }\n    var ch1 = options.ch1;\n    var ch2 = options.ch2;\n    var ch3 = options.ch3;\n    var ch4 = options.ch4;\n    var letterArray =\n      options.pdfColorType === \"draw\" ? [\"G\", \"RG\", \"K\"] : [\"g\", \"rg\", \"k\"];\n\n    if (typeof ch1 === \"string\" && ch1.charAt(0) !== \"#\") {\n      var rgbColor = new RGBColor(ch1);\n      if (rgbColor.ok) {\n        ch1 = rgbColor.toHex();\n      } else if (!/^\\d*\\.?\\d*$/.test(ch1)) {\n        throw new Error(\n          'Invalid color \"' + ch1 + '\" passed to jsPDF.encodeColorString.'\n        );\n      }\n    }\n    //convert short rgb to long form\n    if (typeof ch1 === \"string\" && /^#[0-9A-Fa-f]{3}$/.test(ch1)) {\n      ch1 = \"#\" + ch1[1] + ch1[1] + ch1[2] + ch1[2] + ch1[3] + ch1[3];\n    }\n\n    if (typeof ch1 === \"string\" && /^#[0-9A-Fa-f]{6}$/.test(ch1)) {\n      var hex = parseInt(ch1.substr(1), 16);\n      ch1 = (hex >> 16) & 255;\n      ch2 = (hex >> 8) & 255;\n      ch3 = hex & 255;\n    }\n\n    if (\n      typeof ch2 === \"undefined\" ||\n      (typeof ch4 === \"undefined\" && ch1 === ch2 && ch2 === ch3)\n    ) {\n      // Gray color space.\n      if (typeof ch1 === \"string\") {\n        color = ch1 + \" \" + letterArray[0];\n      } else {\n        switch (options.precision) {\n          case 2:\n            color = f2(ch1 / 255) + \" \" + letterArray[0];\n            break;\n          case 3:\n          default:\n            color = f3(ch1 / 255) + \" \" + letterArray[0];\n        }\n      }\n    } else if (typeof ch4 === \"undefined\" || typeof ch4 === \"object\") {\n      // assume RGBA\n      if (ch4 && !isNaN(ch4.a)) {\n        //TODO Implement transparency.\n        //WORKAROUND use white for now, if transparent, otherwise handle as rgb\n        if (ch4.a === 0) {\n          color = [\"1.\", \"1.\", \"1.\", letterArray[1]].join(\" \");\n          return color;\n        }\n      }\n      // assume RGB\n      if (typeof ch1 === \"string\") {\n        color = [ch1, ch2, ch3, letterArray[1]].join(\" \");\n      } else {\n        switch (options.precision) {\n          case 2:\n            color = [\n              f2(ch1 / 255),\n              f2(ch2 / 255),\n              f2(ch3 / 255),\n              letterArray[1]\n            ].join(\" \");\n            break;\n          default:\n          case 3:\n            color = [\n              f3(ch1 / 255),\n              f3(ch2 / 255),\n              f3(ch3 / 255),\n              letterArray[1]\n            ].join(\" \");\n        }\n      }\n    } else {\n      // assume CMYK\n      if (typeof ch1 === \"string\") {\n        color = [ch1, ch2, ch3, ch4, letterArray[2]].join(\" \");\n      } else {\n        switch (options.precision) {\n          case 2:\n            color = [f2(ch1), f2(ch2), f2(ch3), f2(ch4), letterArray[2]].join(\n              \" \"\n            );\n            break;\n          case 3:\n          default:\n            color = [f3(ch1), f3(ch2), f3(ch3), f3(ch4), letterArray[2]].join(\n              \" \"\n            );\n        }\n      }\n    }\n    return color;\n  });\n\n  var getFilters = (API.__private__.getFilters = function() {\n    return filters;\n  });\n\n  var putStream = (API.__private__.putStream = function(options) {\n    options = options || {};\n    var data = options.data || \"\";\n    var filters = options.filters || getFilters();\n    var alreadyAppliedFilters = options.alreadyAppliedFilters || [];\n    var addLength1 = options.addLength1 || false;\n    var valueOfLength1 = data.length;\n\n    var processedData = {};\n    if (filters === true) {\n      filters = [\"FlateEncode\"];\n    }\n    var keyValues = options.additionalKeyValues || [];\n    if (typeof jsPDF.API.processDataByFilters !== \"undefined\") {\n      processedData = jsPDF.API.processDataByFilters(data, filters);\n    } else {\n      processedData = { data: data, reverseChain: [] };\n    }\n    var filterAsString =\n      processedData.reverseChain +\n      (Array.isArray(alreadyAppliedFilters)\n        ? alreadyAppliedFilters.join(\" \")\n        : alreadyAppliedFilters.toString());\n\n    if (processedData.data.length !== 0) {\n      keyValues.push({\n        key: \"Length\",\n        value: processedData.data.length\n      });\n      if (addLength1 === true) {\n        keyValues.push({\n          key: \"Length1\",\n          value: valueOfLength1\n        });\n      }\n    }\n\n    if (filterAsString.length != 0) {\n      if (filterAsString.split(\"/\").length - 1 === 1) {\n        keyValues.push({\n          key: \